% runme_lightprobe.m  Demonstration of how to construct light probes from%                     data in light_probe.txt% read light probe datalpdata = load('light_probes.txt');% choose a random light probelp = lpdata( ceil(rand*size(lpdata,1)),: );% construct the light probe's spherical harmonic coefficientscr = lp(2:2:18);  % real componentsci = lp(3:2:19);  % imaginary componentsc = cr + 1i*ci;   % complex coefficients% make coordinate matrices in polar coordinatesthetavec = ( 0.5:179.5 )*(pi/180);phivec   = ( -180:179  )*(pi/180);[ phimat, thetamat ] = meshgrid( phivec, thetavec );% construct light probe by summing spherical harmonics% (can do this more efficiently with matrix operations, but here we use%  nested for loops to make it clearer what's happening)lpmat = zeros(size(thetamat));for el = 0:2    for m = -el:el        i = el^2+el+m+1; % c(i) is coefficient c_l,m        lpmat = lpmat + c(i)*sphharm( el, m, thetamat, phimat );    endend% trim imaginary components that occur due to rounding error% (in real life we check the size of the imaginary components first,%  to make sure they really are just rounding error)lpmat = real( lpmat );% show light probeimagesc( lpmat );% calculate illuminance contrast energy% (though this is also given as a column in light_probes.txt)lambda = ice( c );title(sprintf('ICE = %.2f',lambda));